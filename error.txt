E.F.EEEEEEEEE.EE.F....F................EEE.E..E.EEEEEEEEEEEEEEEEEEEEEE...EEEEEEEEEEEEEEEEEEEEEEEEEEEEEE.
======================================================================
ERROR: test_MetricsMongoDBController_assemble_ujs_state (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 1798, in test_MetricsMongoDBController_assemble_ujs_state
    exec_task_map)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 424, in _assemble_ujs_state
    ws_name = self.get_narrative_info(u_j_s['wsid'])[0]
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 278, in get_narrative_info
    narrative_name_map = self.narrative_cache.get()
  File "/kb/module/lib/kb_Metrics/NarrativeCache.py", line 108, in get
    return self._get()
  File "/kb/module/lib/kb_Metrics/NarrativeCache.py", line 43, in _get
    include_del=True)
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 374, in list_ws_narratives
    return list(kbworkspaces.aggregate(pipeline))
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 2452, in aggregate
    with self.__database.client._tmp_session(session, close=False) as s:
  File "/miniconda/lib/python3.6/contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1829, in _tmp_session
    s = self._ensure_session(session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f7, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_MetricsMongoDBController_get_active_users_counts (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2757, in test_MetricsMongoDBController_get_active_users_counts
    self.getContext()['token'], False)['metrics_result']
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1089, in get_active_users_counts
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_MetricsMongoDBController_get_narrative_info (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2156, in test_MetricsMongoDBController_get_narrative_info
    8781)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 278, in get_narrative_info
    narrative_name_map = self.narrative_cache.get()
  File "/kb/module/lib/kb_Metrics/NarrativeCache.py", line 108, in get
    return self._get()
  File "/kb/module/lib/kb_Metrics/NarrativeCache.py", line 51, in _get
    include_del=True)
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 374, in list_ws_narratives
    return list(kbworkspaces.aggregate(pipeline))
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 2452, in aggregate
    with self.__database.client._tmp_session(session, close=False) as s:
  File "/miniconda/lib/python3.6/contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1829, in _tmp_session
    s = self._ensure_session(session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f7, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_MetricsMongoDBController_get_narrative_name_map (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2112, in test_MetricsMongoDBController_get_narrative_name_map
    wnarr_map = self.narrative_cache.get()
  File "/kb/module/lib/kb_Metrics/NarrativeCache.py", line 108, in get
    return self._get()
  File "/kb/module/lib/kb_Metrics/NarrativeCache.py", line 51, in _get
    include_del=True)
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 374, in list_ws_narratives
    return list(kbworkspaces.aggregate(pipeline))
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 2452, in aggregate
    with self.__database.client._tmp_session(session, close=False) as s:
  File "/miniconda/lib/python3.6/contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1829, in _tmp_session
    s = self._ensure_session(session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60fc, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_MetricsMongoDBController_get_narratives_from_wsobjs (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/miniconda/lib/python3.6/unittest/mock.py", line 1179, in patched
    return func(*args, **keywargs)
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2082, in test_MetricsMongoDBController_get_narratives_from_wsobjs
    params, self.getContext()['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 217, in _get_narratives_from_wsobjs
    minT=params['minTime'], maxT=params['maxTime'])
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 374, in list_ws_narratives
    return list(kbworkspaces.aggregate(pipeline))
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 2452, in aggregate
    with self.__database.client._tmp_session(session, close=False) as s:
  File "/miniconda/lib/python3.6/contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1829, in _tmp_session
    s = self._ensure_session(session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f2, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_MetricsMongoDBController_get_signup_retn_users (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/miniconda/lib/python3.6/unittest/mock.py", line 1179, in patched
    return func(*args, **keywargs)
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2572, in test_MetricsMongoDBController_get_signup_retn_users
    self.getContext()['token'])['metrics_result']
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1136, in get_signup_retn_users
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_MetricsMongoDBController_get_user_details (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2524, in test_MetricsMongoDBController_get_user_details
    params, self.getContext()['token'])['metrics_result']
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1114, in get_user_details
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_MetricsMongoDBController_get_user_login_stats_from_ws (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2710, in test_MetricsMongoDBController_get_user_login_stats_from_ws
    self.getContext()['token'])['metrics_result']
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1013, in get_user_login_stats_from_ws
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_MetricsMongoDBController_join_task_ujs (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 1961, in test_MetricsMongoDBController_join_task_ujs
    ujs_jobs)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 347, in _join_task_ujs
    u_j_s = self._assemble_ujs_state(ujs_job, exec_task_map)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 424, in _assemble_ujs_state
    ws_name = self.get_narrative_info(u_j_s['wsid'])[0]
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 278, in get_narrative_info
    narrative_name_map = self.narrative_cache.get()
  File "/kb/module/lib/kb_Metrics/NarrativeCache.py", line 108, in get
    return self._get()
  File "/kb/module/lib/kb_Metrics/NarrativeCache.py", line 51, in _get
    include_del=True)
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 374, in list_ws_narratives
    return list(kbworkspaces.aggregate(pipeline))
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 2452, in aggregate
    with self.__database.client._tmp_session(session, close=False) as s:
  File "/miniconda/lib/python3.6/contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1829, in _tmp_session
    s = self._ensure_session(session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f7, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_MetricsMongoDBController_map_ws_narrative_names (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2139, in test_MetricsMongoDBController_map_ws_narrative_names
    'qzhang', ws_ids, self.getContext()['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 712, in map_ws_narrative_names
    w_nm, n_name, n_ver, is_deleted = self.get_narrative_info(w_id)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 278, in get_narrative_info
    narrative_name_map = self.narrative_cache.get()
  File "/kb/module/lib/kb_Metrics/NarrativeCache.py", line 108, in get
    return self._get()
  File "/kb/module/lib/kb_Metrics/NarrativeCache.py", line 51, in _get
    include_del=True)
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 374, in list_ws_narratives
    return list(kbworkspaces.aggregate(pipeline))
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 2452, in aggregate
    with self.__database.client._tmp_session(session, close=False) as s:
  File "/miniconda/lib/python3.6/contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1829, in _tmp_session
    s = self._ensure_session(session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f7, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_MetricsMongoDBController_update_narratives (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/miniconda/lib/python3.6/unittest/mock.py", line 1179, in patched
    return func(*args, **keywargs)
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2315, in test_MetricsMongoDBController_update_narratives
    params, self.getContext()['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 172, in _update_narratives
    ws_ret = self._get_narratives_from_wsobjs(params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 217, in _get_narratives_from_wsobjs
    minT=params['minTime'], maxT=params['maxTime'])
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 374, in list_ws_narratives
    return list(kbworkspaces.aggregate(pipeline))
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 2452, in aggregate
    with self.__database.client._tmp_session(session, close=False) as s:
  File "/miniconda/lib/python3.6/contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1829, in _tmp_session
    s = self._ensure_session(session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f2, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_MetricsMongoDBController_update_user_info (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2255, in test_MetricsMongoDBController_update_user_info
    params, self.getContext()['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 113, in _update_user_info
    params['user_ids'], params['minTime'], params['maxTime'])
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 586, in aggr_user_details
    return sorted(list(kbusers.aggregate(pipeline)),
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 2452, in aggregate
    with self.__database.client._tmp_session(session, close=False) as s:
  File "/miniconda/lib/python3.6/contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1829, in _tmp_session
    s = self._ensure_session(session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f4, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_db_controller_get_activities_from_wsobjs (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/miniconda/lib/python3.6/unittest/mock.py", line 1179, in patched
    return func(*args, **keywargs)
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2025, in test_db_controller_get_activities_from_wsobjs
    params, self.getContext()['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 324, in _get_activities_from_wsobjs
    params['minTime'], params['maxTime'])
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 255, in aggr_activities_from_wsobjs
    return list(activities.aggregate(pipeline))
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 2452, in aggregate
    with self.__database.client._tmp_session(session, close=False) as s:
  File "/miniconda/lib/python3.6/contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1829, in _tmp_session
    s = self._ensure_session(session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f2, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_db_controller_get_kbstaff_list (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 1517, in test_db_controller_get_kbstaff_list
    kb_list = self.db_controller._get_kbstaff_list()
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 84, in _get_kbstaff_list
    kbstaff = self.metrics_dbi.list_kbstaff_usernames()
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 534, in list_kbstaff_usernames
    return list(kbusers.find(kbstaff_filter, projection))
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 1207, in next
    if len(self.__data) or self._refresh():
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 1100, in _refresh
    self.__session = self.__collection.database.client._ensure_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f0, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_db_controller_get_user_job_states (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2366, in test_db_controller_get_user_job_states
    requesting_user1, input_params, self.getContext()['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 751, in get_user_job_states
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 693, in list_ujs_results
    total_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f1, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_db_controller_is_kbstaff (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 1499, in test_db_controller_is_kbstaff
    self.assertFalse(self.db_controller._is_kbstaff(not_kbu))
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 79, in _is_kbstaff
    kb_list = self._get_kbstaff_list()
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 84, in _get_kbstaff_list
    kbstaff = self.metrics_dbi.list_kbstaff_usernames()
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 534, in list_kbstaff_usernames
    return list(kbusers.find(kbstaff_filter, projection))
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 1207, in next
    if len(self.__data) or self._refresh():
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 1100, in _refresh
    self.__session = self.__collection.database.client._ensure_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f0, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_db_controller_update_daily_activities (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2282, in test_db_controller_update_daily_activities
    params, self.getContext()['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 142, in _update_daily_activities
    ws_ret = self._get_activities_from_wsobjs(params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 324, in _get_activities_from_wsobjs
    params['minTime'], params['maxTime'])
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 255, in aggr_activities_from_wsobjs
    return list(activities.aggregate(pipeline))
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 2452, in aggregate
    with self.__database.client._tmp_session(session, close=False) as s:
  File "/miniconda/lib/python3.6/contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1829, in _tmp_session
    s = self._ensure_session(session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8007431da53787fb60f2, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_get_all_narrative_stats (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3087, in test_run_MetricsImpl_get_all_narrative_stats
    m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 590, in get_all_narrative_stats
    ctx['user_id'], params, ctx['token'], exclude_kbstaff=False)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 957, in get_narrative_stats
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_get_app_metrics (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3213, in test_run_MetricsImpl_get_app_metrics
    ret = self.getImpl().get_app_metrics(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 64, in get_app_metrics
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 751, in get_user_job_states
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 693, in list_ujs_results
    total_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8192431da53787fb61c4, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_get_job (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3336, in test_run_MetricsImpl_get_job
    ret = self.getImpl().get_job(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 239, in get_job
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 924, in get_user_job_state
    params['job_id'], user_id=user_id)
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 919, in get_ujs_result
    results = json.loads(json_util.dumps(list(cursor)))
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 1207, in next
    if len(self.__data) or self._refresh():
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 1100, in _refresh
    self.__session = self.__collection.database.client._ensure_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1816, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1766, in __start_session
    server_session = self._get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1802, in _get_server_session
    return self._topology.get_server_session()
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 488, in get_server_session
    None)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d81b0431da53787fb61ce, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_get_jobs (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3258, in test_run_MetricsImpl_get_jobs
    ret = self.getImpl().get_jobs(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 109, in get_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 751, in get_user_job_states
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 693, in list_ujs_results
    total_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d81cf431da53787fb61d8, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_get_jobs_no_results (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3302, in test_run_MetricsImpl_get_jobs_no_results
    ret = self.getImpl().get_jobs(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 109, in get_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 751, in get_user_job_states
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 693, in list_ujs_results
    total_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d81ee431da53787fb61e2, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_get_narrative_stats (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3073, in test_run_MetricsImpl_get_narrative_stats
    ret = self.getImpl().get_narrative_stats(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 563, in get_narrative_stats
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 957, in get_narrative_stats
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_get_nonkb_total_logins (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2971, in test_run_MetricsImpl_get_nonkb_total_logins
    m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 482, in get_nonkb_total_logins
    ctx['user_id'], params, ctx['token'], exclude_kbstaff=True)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 992, in get_total_logins_from_ws
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_get_nonkbuser_details (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3451, in test_run_MetricsImpl_get_nonkbuser_details
    ret = self.getImpl().get_nonkbuser_details(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 347, in get_nonkbuser_details
    ctx['user_id'], params, ctx['token'], exclude_kbstaff=True)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1114, in get_user_details
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_get_signup_returning_users (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/miniconda/lib/python3.6/unittest/mock.py", line 1179, in patched
    return func(*args, **keywargs)
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3537, in test_run_MetricsImpl_get_signup_returning_users
    self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 374, in get_signup_returning_users
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1136, in get_signup_retn_users
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_get_total_logins (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2931, in test_run_MetricsImpl_get_total_logins
    ret = self.getImpl().get_total_logins(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 455, in get_total_logins
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 992, in get_total_logins_from_ws
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_get_user_counts_per_day (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3509, in test_run_MetricsImpl_get_user_counts_per_day
    self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 428, in get_user_counts_per_day
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1089, in get_active_users_counts
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_get_user_details (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3380, in test_run_MetricsImpl_get_user_details
    ret = self.getImpl().get_user_details(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 320, in get_user_details
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1114, in get_user_details
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_get_user_logins (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3101, in test_run_MetricsImpl_get_user_logins
    ret = self.getImpl().get_user_logins(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 509, in get_user_logins
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1013, in get_user_login_stats_from_ws
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_get_user_numObjs (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3157, in test_run_MetricsImpl_get_user_numObjs
    ret = self.getImpl().get_user_numObjs(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 536, in get_user_numObjs
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1027, in get_user_numObjs_from_ws
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_get_user_ws_stats (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3012, in test_run_MetricsImpl_get_user_ws_stats
    ret = self.getImpl().get_user_ws_stats(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 617, in get_user_ws_stats
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1043, in get_user_ws_stats
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_is_admin (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3586, in test_run_MetricsImpl_is_admin
    'username': self.test_cfg['test_username']
KeyError: 'test_username'

======================================================================
ERROR: test_run_MetricsImpl_map_ws_narrative_names (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2910, in test_run_MetricsImpl_map_ws_narrative_names
    self.getContext(), ws_ids)[0]
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 263, in map_ws_narrative_names
    ctx['token'])   # noqa 501
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 707, in map_ws_narrative_names
    raise ValueError('You do not have permission to '
ValueError: You do not have permission to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_update_metrics (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 3576, in test_run_MetricsImpl_update_metrics
    ret = self.getImpl().update_metrics(self.getContext(), m_params)
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 292, in update_metrics
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1065, in update_metrics
    raise ValueError('You do not have permission to '
ValueError: You do not have permission to invoke this action.

======================================================================
ERROR: test_run_MetricsMongoDBController_get_narrative_stats (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2890, in test_run_MetricsMongoDBController_get_narrative_stats
    self.getContext()['token'])['metrics_result']
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 957, in get_narrative_stats
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsMongoDBController_get_total_logins_from_ws (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2456, in test_run_MetricsMongoDBController_get_total_logins_from_ws
    params, self.getContext()['token'])['metrics_result']
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 992, in get_total_logins_from_ws
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsMongoDBController_get_user_numObjs_from_ws (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2658, in test_run_MetricsMongoDBController_get_user_numObjs_from_ws
    self.getContext()['token'])['metrics_result']
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1027, in get_user_numObjs_from_ws
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsMongoDBController_get_user_ws_stats (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 2790, in test_run_MetricsMongoDBController_get_user_ws_stats
    self.getContext()['token'])['metrics_result']
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 1043, in get_user_ws_stats
    raise ValueError('You do not have permisson to '
ValueError: You do not have permisson to invoke this action.

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_cancel (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 189, in test_run_MetricsImpl_query_jobs_filter_by_status_cancel
    'status': ['cancel']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d820d431da53787fb6222, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_cancel_or_error (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 207, in test_run_MetricsImpl_query_jobs_filter_by_status_cancel_or_error
    'status': ['cancel', 'error']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d822b431da53787fb622c, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_complete (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 153, in test_run_MetricsImpl_query_jobs_filter_by_status_complete
    'status': ['complete']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d824a431da53787fb6236, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_error (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 171, in test_run_MetricsImpl_query_jobs_filter_by_status_error
    'status': ['error']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8269431da53787fb6240, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_queue (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 119, in test_run_MetricsImpl_query_jobs_filter_by_status_queue
    'status': ['queue']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8287431da53787fb624a, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_queue_or_run (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 226, in test_run_MetricsImpl_query_jobs_filter_by_status_queue_or_run
    'status': ['queue', 'run']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d82a6431da53787fb6254, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_run (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 136, in test_run_MetricsImpl_query_jobs_filter_by_status_run
    'status': ['run']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d82c4431da53787fb625e, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_max_time_range (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 44, in test_run_MetricsImpl_query_jobs_max_time_range
    'epoch_range': [0, now]
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d82e3431da53787fb6268, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_max_time_range_paged (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 63, in test_run_MetricsImpl_query_jobs_max_time_range_paged
    'limit': 5
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8302431da53787fb6272, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_no_params (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 27, in test_run_MetricsImpl_query_jobs_no_params
    ret = self.getImpl().query_jobs(self.getContext(), {
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d8321431da53787fb627c, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_one_job (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 101, in test_run_MetricsImpl_query_jobs_one_job
    'job_id': ['59691279e4b08b65f9ff5d87']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d833f431da53787fb6286, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_one_user (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 83, in test_run_MetricsImpl_query_jobs_one_user
    'user_id': ['psdehal']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d835e431da53787fb6290, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_search (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 401, in test_run_MetricsImpl_query_jobs_search
    ret = self.getImpl().query_jobs(self.getContext(), datum['input'])
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d837c431da53787fb629a, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_sort2 (enabled.query_jobs.kb_Metrics_server_query_jobs_test.kb_Metrics_query_jobs_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs/kb_Metrics_server_query_jobs_test.py", line 277, in test_run_MetricsImpl_query_jobs_sort2
    ret = self.getImpl().query_jobs(self.getContext(), case['input'])
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 155, in query_jobs
    ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 807, in query_jobs_user
    return self.query_jobs(requesting_user, params, token)
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 848, in query_jobs
    sort=params.get('sort', None))
  File "/kb/module/lib/kb_Metrics/metrics_dbi.py", line 878, in query_ujs
    found_count = cursor.count()
  File "/miniconda/lib/python3.6/site-packages/pymongo/cursor.py", line 823, in count
    cmd, self.__collation, session=self.__session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/collection.py", line 1665, in _count
    _cmd, self._read_preference_for(session), session)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1461, in _retryable_read
    read_pref, session, address=address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/mongo_client.py", line 1278, in _select_server
    server = topology.select_server(server_selector)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 243, in select_server
    address))
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 200, in select_servers
    selector, server_timeout, address)
  File "/miniconda/lib/python3.6/site-packages/pymongo/topology.py", line 217, in _select_servers_loop
    (self._error_message(selector), timeout, self.description))
pymongo.errors.ServerSelectionTimeoutError: 123:27017: [Errno 111] Connection refused, Timeout: 30s, Topology Description: <TopologyDescription id: 602d839b431da53787fb62a4, topology_type: Single, servers: [<ServerDescription ('123', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('123:27017: [Errno 111] Connection refused',)>]>

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_job_id_2 (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 409, in test_run_MetricsImpl_query_jobs_filter_by_job_id_2
    'job_id': ['5d4493a9aa5a4d298c5dc930']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_job_id_run (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 393, in test_run_MetricsImpl_query_jobs_filter_by_job_id_run
    'job_id': ['596832a4e4b08b65f9ff5d6f']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_cancel (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 177, in test_run_MetricsImpl_query_jobs_filter_by_status_cancel
    'status': ['terminate']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_cancel_or_error (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 194, in test_run_MetricsImpl_query_jobs_filter_by_status_cancel_or_error
    'status': ['terminate', 'error']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_complete (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 144, in test_run_MetricsImpl_query_jobs_filter_by_status_complete
    'status': ['complete']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_error (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 161, in test_run_MetricsImpl_query_jobs_filter_by_status_error
    'status': ['error']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_queue (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 107, in test_run_MetricsImpl_query_jobs_filter_by_status_queue
    'status': ['queue']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_queue_or_run (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 211, in test_run_MetricsImpl_query_jobs_filter_by_status_queue_or_run
    'status': ['queue', 'run']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_filter_by_status_run (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 124, in test_run_MetricsImpl_query_jobs_filter_by_status_run
    'status': ['run']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_max_time_range (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 33, in test_run_MetricsImpl_query_jobs_max_time_range
    'epoch_range': [0, now]
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_max_time_range_paged (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 51, in test_run_MetricsImpl_query_jobs_max_time_range_paged
    'limit': 5
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_no_params (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 17, in test_run_MetricsImpl_query_jobs_no_params
    ret = self.getImpl().query_jobs_admin(self.getContext(), {
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_one_job (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)

host: 123
user: 123
----------------------------------------------------------------------password: 123
config: {'kbase-endpoint': 'https://ci.kbase.us/services', 'job-service-url': 'https://ci.kbase.us/services/userandjobstate', 'workspace-url': 'https://ci.kbase.us/services/ws', 'shock-url': 'https://ci.kbase.us/services/shock-api', 'handle-service-url': 'https://ci.kbase.us/services/handle_service', 'srv-wiz-url': 'https://ci.kbase.us/services/service_wizard', 'njsw-url': 'https://ci.kbase.us/services/njs_wrapper', 'auth-service-url': 'https://ci.kbase.us/services/auth/api/legacy/KBase/Sessions/Login', 'auth-service-url-allow-insecure': 'false', 'scratch': '/kb/module/work/tmp', 'mongodb-user': '123', 'mongodb-pwd': '123', 'mongodb-host': '123', 'admin-users': 'kkeller,scanon,psdehal,dolson,dylan,chenry,ciservices,wjriehl,sychan,jjeffryes,eapearson,qzhang,tgu2,drakemm2,allenbh,bsadkhin,bobcottingham,janakakbase,jplfaria,marcin,royk,sunita,aparkin,cnelson,landml', 'metrics-admins': 'scanon,psdehal,dolson,chenry,wjriehl,sychan,qzhang,tgu2,eapearson,jjeffryes,cnelson', 'mongodb-databases': 'metrics, userjobstate, workspace, exec_engine, auth2'}

host: 123
user: 123
password: 123Traceback (most recent call last):

  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 88, in test_run_MetricsImpl_query_jobs_one_jobconfig: {'kbase-endpoint': 'https://ci.kbase.us/services', 'job-service-url': 'https://ci.kbase.us/services/userandjobstate', 'workspace-url': 'https://ci.kbase.us/services/ws', 'shock-url': 'https://ci.kbase.us/services/shock-api', 'handle-service-url': 'https://ci.kbase.us/services/handle_service', 'srv-wiz-url': 'https://ci.kbase.us/services/service_wizard', 'njsw-url': 'https://ci.kbase.us/services/njs_wrapper', 'auth-service-url': 'https://ci.kbase.us/services/auth/api/legacy/KBase/Sessions/Login', 'auth-service-url-allow-insecure': 'false', 'scratch': '/kb/module/work/tmp', 'mongodb-user': '123', 'mongodb-pwd': '123', 'mongodb-host': '123', 'admin-users': 'kkeller,scanon,psdehal,dolson,dylan,chenry,ciservices,wjriehl,sychan,jjeffryes,eapearson,qzhang,tgu2,drakemm2,allenbh,bsadkhin,bobcottingham,janakakbase,jplfaria,marcin,royk,sunita,aparkin,cnelson,landml', 'metrics-admins': 'scanon,psdehal,dolson,chenry,wjriehl,sychan,qzhang,tgu2,eapearson,jjeffryes,cnelson', 'mongodb-databases': 'metrics, userjobstate, workspace, exec_engine, auth2'}
host: 123
user: 123
password: 123
config: {'kbase-endpoint': 'https://ci.kbase.us/services', 'job-service-url': 'https://ci.kbase.us/services/userandjobstate', 'workspace-url': 'https://ci.kbase.us/services/ws', 'shock-url': 'https://ci.kbase.us/services/shock-api', 'handle-service-url': 'https://ci.kbase.us/services/handle_service', 'srv-wiz-url': 'https://ci.kbase.us/services/service_wizard', 'njsw-url': 'https://ci.kbase.us/services/njs_wrapper', 'auth-service-url': 'https://ci.kbase.us/services/auth/api/legacy/KBase/Sessions/Login', 'auth-service-url-allow-insecure': 'false', 'scratch': '/kb/module/work/tmp', 'mongodb-user': '123', 'mongodb-pwd': '123', 'mongodb-host': '123', 'admin-users': 'kkeller,scanon,psdehal,dolson,dylan,chenry,ciservices,wjriehl,sychan,jjeffryes,eapearson,qzhang,tgu2,drakemm2,allenbh,bsadkhin,bobcottingham,janakakbase,jplfaria,marcin,royk,sunita,aparkin,cnelson,landml', 'metrics-admins': 'scanon,psdehal,dolson,chenry,wjriehl,sychan,qzhang,tgu2,eapearson,jjeffryes,cnelson', 'mongodb-databases': 'metrics, userjobstate, workspace, exec_engine, auth2'}
host: 123
user: 123

password: 123
config: {'kbase-endpoint': 'https://ci.kbase.us/services', 'job-service-url': 'https://ci.kbase.us/services/userandjobstate', 'workspace-url': 'https://ci.kbase.us/services/ws', 'shock-url': 'https://ci.kbase.us/services/shock-api', 'handle-service-url': 'https://ci.kbase.us/services/handle_service', 'srv-wiz-url': 'https://ci.kbase.us/services/service_wizard', 'njsw-url': 'https://ci.kbase.us/services/njs_wrapper', 'auth-service-url': 'https://ci.kbase.us/services/auth/api/legacy/KBase/Sessions/Login', 'auth-service-url-allow-insecure': 'false', 'scratch': '/kb/module/work/tmp', 'mongodb-user': '', 'mongodb-pwd': '', 'mongodb-host': '', 'admin-users': 'kkeller,scanon,psdehal,dolson,dylan,chenry,ciservices,wjriehl,sychan,jjeffryes,eapearson,qzhang,tgu2,drakemm2,allenbh,bsadkhin,bobcottingham,janakakbase,jplfaria,marcin,royk,sunita,aparkin,cnelson,landml', 'metrics-admins': 'scanon,psdehal,dolson,chenry,wjriehl,sychan,qzhang,tgu2,eapearson,jjeffryes,cnelson', 'mongodb-databases': 'metrics, userjobstate, workspace, exec_engine, auth2'}
host: 123
user: 123    'job_id': ['5a68dffce4b0ace8f870f586']
password: 123

  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_one_user (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 70, in test_run_MetricsImpl_query_jobs_one_user
    'user_id': ['psdehal']
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_search (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 378, in test_run_MetricsImpl_query_jobs_search
    self.getContext(), datum['input'])
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
ERROR: test_run_MetricsImpl_query_jobs_sort2 (enabled.query_jobs_admin.kb_Metrics_server_query_jobs_admin_test.kb_Metrics_query_jobs_admin_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/query_jobs_admin/kb_Metrics_server_query_jobs_admin_test.py", line 259, in test_run_MetricsImpl_query_jobs_sort2
    self.getContext(), datum['input'])
  File "/kb/module/lib/kb_Metrics/kb_MetricsImpl.py", line 200, in query_jobs_admin
    ctx['user_id'], params, ctx['token'])
  File "/kb/module/lib/kb_Metrics/metricsdb_controller.py", line 800, in query_jobs_admin
    raise ValueError('Sorry, only admins allowed')
ValueError: Sorry, only admins allowed

======================================================================
FAIL: test_MetricsMongoDBController_constructor (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 1313, in test_MetricsMongoDBController_constructor
    pass
AssertionError: ConfigurationError not raised

======================================================================
FAIL: test_MetricsMongoDBs_aggr_signup_retn_users (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/miniconda/lib/python3.6/unittest/mock.py", line 1179, in patched
    return func(*args, **keywargs)
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 206, in test_MetricsMongoDBs_aggr_signup_retn_users
    self.assertEqual(len(users), 6)
AssertionError: 7 != 6

======================================================================
FAIL: test_MetricsMongoDBs_get_user_info (enabled.methods.kb_Metrics_server_test.kb_Metrics_Main_Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/miniconda/lib/python3.6/unittest/mock.py", line 1179, in patched
    return func(*args, **keywargs)
  File "/kb/module/test/enabled/methods/kb_Metrics_server_test.py", line 1013, in test_MetricsMongoDBs_get_user_info
    self.assertEqual(len(users), 37)
AssertionError: 30 != 37

Name                                 Stmts   Miss  Cover
--------------------------------------------------------
kb_Metrics/NarrativeCache.py            63     32    49%
kb_Metrics/Util.py                      22      2    91%
kb_Metrics/__init__.py                   0      0   100%
kb_Metrics/authclient.py                59     19    68%
kb_Metrics/kb_MetricsImpl.py           123     68    45%
kb_Metrics/kb_MetricsServer.py         410    275    33%
kb_Metrics/metrics_dbi.py              438     97    78%
kb_Metrics/metricsdb_controller.py     609    387    36%
--------------------------------------------------------
TOTAL                                 1724    880    49%
----------------------------------------------------------------------
Ran 104 tests in 950.088s

FAILED (errors=69, failures=3)
make: *** [test] Error 1Makefile:65: recipe for target 'test' failed

Shutting down callback server...
1613595581.02 - CallbackServer: Shutting down executor service
(base) [zimingyang@LCC-167000:~/kbaseapps/kb_Metrics]$
